<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Formulario de Pruebas</title>
    <link rel="stylesheet" href="/static/css/style.css" />
</head>
<body>
<div style="display: flex; justify-content: space-between; align-items: center;">
    <h1 style="margin: 0;">Formulario de Pruebas Eléctricas</h1>
    <a href="/logout" style="padding: 8px 12px; background-color: #d9534f; color: white; text-decoration: none; border-radius: 5px;">
        Cerrar Sesión
    </a>
</div>

<form id="formulario-pruebas" enctype="multipart/form-data">
    <fieldset>
        <label>Proyecto:
  <select id="proyecto-id" name="proyecto_id" required>
    <option value="">Cargando...</option>
  </select>
</label>
        <legend>1. Datos del Equipo</legend>
        <label>Ubicación (COLO): <input type="text" id="colo" required /></label>
        <label>Celda (CE): <input type="text" id="ce" required /></label>
        <label>Tipo de equipo:
            <select id="tipo-equipo" required>
                <option value="PDU">PDU</option>
                <option value="MSB">MSB</option>
                <option value="BSW">BSW</option>
            </select>
        </label>
        <label>ID del equipo: <input type="text" id="codigo-equipo" required /></label>
    </fieldset>

    <fieldset>
        <legend>2. Prueba</legend>
        <label>Tipo de prueba:
            <select id="tipo-prueba" required>
                <option value="">Selecciona la prueba</option>
                <option value="continuidad">Continuidad</option>
                <option value="megado">Megado</option>
            </select>
        </label>
        <label>Valor de Referencia:
    <input type="text" id="referencia-comun" placeholder="Ej: 0.3 Ω" required />
</label>
<div id="campo-tiempo-aplicado" style="display: none;">
    <label>Tiempo aplicado (s):
        <input type="text" id="tiempo-aplicado-global" placeholder="Ej: 60" />
    </label>
</div>
        <label>Cable Sets: <input type="number" id="cable-set" min="1" value="1" required /></label>
    </fieldset>

 <div id="bloque-resultados" style="display:none; margin-top: 30px;">
    <h4>3. Resultados Test</h4>
    <div id="contenedor-resultados"></div>
</div>
    <button type="submit">Guardar</button>
</form>
<script>
document.addEventListener("DOMContentLoaded", async () => {
  const selectProyecto = document.getElementById("proyecto-id");

  try {
    const res = await fetch("/proyectos/");
    const proyectos = await res.json();

    selectProyecto.innerHTML = "";
    proyectos.forEach((p) => {
      const option = document.createElement("option");
      option.value = p.id;
      option.textContent = p.nombre;
      selectProyecto.appendChild(option);
    });
  } catch (err) {
    selectProyecto.innerHTML = '<option>Error cargando proyectos</option>';
  }
});
</script>
<script src="/static/js/formulario_loader.js"></script>
</body>
</html>
